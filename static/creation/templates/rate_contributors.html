{% extends 'spoken/templates/base.html' %}
{% load widget_tweaks %}
{% load static %}
{% load eventsdata %}
{% load cmsdata %}
{% load creationdata %}

{% block compresscssblock %}
    <link rel="stylesheet" href="{% static 'spoken/css/jquery.datetimepicker.css' %}" type="text/css" media="screen" charset="utf-8" />
{% endblock %}

{% block heading %} <i class="fa fa-list-ul"></i> Rate Contributors {% endblock %}
{% block search %}{% endblock %}
{% block content %}
  <div class='filters row' >

    <form action="{{ action }}" method="post" class='form-horizontal'>
      {% csrf_token %}
  
      <div class="col-md-4 col-md-4 col-sm-4">
        
          <div class="form-group">
              <label for="id_language__name" class="col-sm-4 control-label">Language</label>
              <div class="col-sm-8">
                  {% render_field form.language class+="form-control language" tabindex="1" %}
                  {{ form.language.errors }}
              </div>
          </div>
         
      </div>          
  <div>
    <div class="form-group pull-right">
     <a href="{% url 'creation:get_latest_contributors'  %}"> <input class="btn btn-primary" type="button" value="Refresh Contributor list "></a>
    </div>
      
      <div class="form-group col-sm-12">
        <div class="col-sm-offset-4 col-sm-8">
           <input class="btn btn-success" type="submit" value="Filter" />
           <a class="btn btn-success" href="{{request.path}}?{{request.GET|reset_get_values}}">Reset Filter</a>
        </div>
      </div>
  </div>


  
    
  <div class="col-sm-offset-1 col-lg-10">  

    
        <div class="tab-content" >
          <table class="paleblue table table-striped table-hover table-bordered ">
            {% get_sortable_header header ordering request.GET %} 

          {% for record in contributors %}
          <tr class="text-center">
          <td>
            <a class="btn btn-warning" href="#" onclick=enable('{{forloop.counter}}')>Edit</a>
                    </td>
          <td align="center" class="form-group">{{ record.user__username }}</td>       
          </label>
          <td class="form-group">{{record.language__name}}</td>
          
          <td >
          <div align="center">
            <label for="sel1"></label>
            {% if record.status == 0 %}
            <i>Inactive</i>
            {%else%}
            {{record.status}}
            <select disabled name ="rating" id='sel{{forloop.counter}}' class="form-horizontal form-control">
              <option >0</option>
              {% for i in i|rjust:"5" %}
                i ij {{i}}
            
            
            {% if record.rating == forloop.counter %}
              <option selected>{{forloop.counter}}</option>
              {%else%}
              <option >{{ forloop.counter }}</option>
              {% endif %}
            
              {% endfor %}

            </select>
          </div>
          {% endif %}
          </td>
          <td>
      <input onclick=save('{{forloop.counter}}','{{record.user__username}}','{{record.language__name}}') class="btn btn-primary pull-right"  value="Save" \>
          </td>
          </tr>
          </tr > 
          {% endfor %}
    </table>
  </div>
</div>
</form>
</div>
{% endblock %} 


{% block compressjsblock %}
 <script type="text/javascript"> 
function save(id_to_edit , username , language)
{
  element_id = "sel"+id_to_edit;
  var new_rating = $("#"+element_id+" option:selected");
  var username = username;
  
$.ajax({
                type : "POST",
                url:"/creation/rate_contributors/",
                dataType : "json",
                data:
                { 'username' : username, 
                  'language':language,
                  'rating':new_rating.text(),
                  'mode': 'update',
                },
                success: function(data)
                {
                  location.reload();
                }
              });  
}

function enable(id_to_edit)
{
  element_id = "sel"+id_to_edit;
  document.getElementById(element_id).disabled = false;
}

</script>
{% endblock %}
